{% extends "base.html" %}

{% block title %}æˆ‘çš„é€šçŸ¥ - ä¼šè®®ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="page-transition">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>æˆ‘çš„é€šçŸ¥</h1>
        <div>
            <a href="/api/notifications/mark-all-read" class="btn btn-primary">
                <i class="fa fa-check-double"></i> å…¨éƒ¨æ ‡è®°ä¸ºå·²è¯»
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            {% if notifications %}
                <div class="list-group">
                    {% for notification in notifications %}
                        <div class="list-group-item list-group-item-action {% if not notification.is_read %}list-group-item-primary{% endif %}">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">
                                    {% if notification.type == 'friend_request' %}
                                        <i class="fa fa-user-plus"></i> å¥½å‹è¯·æ±‚
                                    {% elif notification.type == 'friend_accepted' %}
                                        <i class="fa fa-handshake"></i> å¥½å‹æ¥å—
                                    {% elif notification.type == 'meeting_invitation' %}
                                        <i class="fa fa-envelope-open"></i> ä¼šè®®é‚€è¯·
                                    {% elif notification.type == 'meeting_joined' %}
                                        <i class="fa fa-sign-in-alt"></i> åŠ å…¥ä¼šè®®
                                    {% elif notification.type == 'meeting_left' %}
                                        <i class="fa fa-sign-out-alt"></i> é€€å‡ºä¼šè®®
                                    {% endif %}
                                </h5>
                                <small>{{ notification.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                            </div>
                            <p class="mb-1">{{ notification.content }}</p>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <div>
                                    {% if notification.sender %}
                                        <small>å‘é€è€…: {{ notification.sender.username }}</small>
                                    {% endif %}
                                </div>
                                <div>
                                    <!-- æ£€æŸ¥é€šçŸ¥å†…å®¹æ˜¯å¦åŒ…å«"é‚€è¯·æ‚¨å‚åŠ ä¼šè®®"ï¼Œå¦‚æœæ˜¯åˆ™æ˜¾ç¤ºæŒ‰é’® -->
                                    {% if "é‚€è¯·æ‚¨å‚åŠ ä¼šè®®" in notification.content and notification.related_id %}
                                        <a href="/api/conferences/{{ notification.related_id }}" class="btn btn-info btn-sm">
                                            <i class="fa fa-eye"></i> æŸ¥çœ‹ä¼šè®®
                                        </a>
                                        <a href="/api/registrations/accept-invitation/{{ notification.related_id }}?direct_accept=true" class="btn btn-success btn-sm">
                                            <i class="fa fa-check-circle"></i> æ¥å—é‚€è¯·
                                        </a>
                                    {% endif %}

                                    {% if not notification.is_read %}
                                        <a href="/api/notifications/mark-read/{{ notification.id }}" class="btn btn-success btn-sm">
                                            <i class="fa fa-check"></i> æ ‡è®°ä¸ºå·²è¯»
                                        </a>
                                    {% endif %}

                                    <a href="/api/notifications/delete/{{ notification.id }}" class="btn btn-danger btn-sm delete-btn" data-confirm-message="ç¡®å®šè¦åˆ é™¤æ­¤é€šçŸ¥å—ï¼Ÿ">
                                        <i class="fa fa-trash"></i> åˆ é™¤
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    æ‚¨æ²¡æœ‰ä»»ä½•é€šçŸ¥ã€‚
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Simulate font awesome icons
        const iconElements = document.querySelectorAll('.fa');
        iconElements.forEach(icon => {
            if (icon.classList.contains('fa-user-plus')) {
                icon.textContent = 'ğŸ‘¥+ ';
            } else if (icon.classList.contains('fa-handshake')) {
                icon.textContent = 'ğŸ¤ ';
            } else if (icon.classList.contains('fa-envelope-open')) {
                icon.textContent = 'ğŸ“© ';
            } else if (icon.classList.contains('fa-sign-in-alt')) {
                icon.textContent = 'â¡ï¸ ';
            } else if (icon.classList.contains('fa-sign-out-alt')) {
                icon.textContent = 'â¬…ï¸ ';
            } else if (icon.classList.contains('fa-check')) {
                icon.textContent = 'âœ… ';
            } else if (icon.classList.contains('fa-check-double')) {
                icon.textContent = 'âœ…âœ… ';
            } else if (icon.classList.contains('fa-trash')) {
                icon.textContent = 'ğŸ—‘ï¸ ';
            } else if (icon.classList.contains('fa-eye')) {
                icon.textContent = 'ğŸ‘ï¸ ';
            } else if (icon.classList.contains('fa-check-circle')) {
                icon.textContent = 'âœ“ ';
            }
        });

        // Style list group items
        document.querySelectorAll('.list-group-item-primary').forEach(item => {
            item.style.backgroundColor = 'rgba(74, 107, 175, 0.1)';
            item.style.borderColor = 'rgba(74, 107, 175, 0.2)';
        });
    });
</script>
{% endblock %}
